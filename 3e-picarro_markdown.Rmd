---
title: "Drydown - Fluxes"
output: github_document
---
Run: `r Sys.Date()`

```{r setup, include=FALSE}

knitr::opts_chunk$set(echo=FALSE,message=FALSE,warning=FALSE,
                      collapse = TRUE,
                      comment = "#>", 
                      fig.path = "images/markdown-picarro/"
                      )

source("0-drydown_functions.R")
picarro_cpcrw = read.csv("data/processed/picarro_processed_cpcrw.csv.gz")

picarro2 = 
    picarro_cpcrw %>% 
    dplyr::mutate(DATETIME2 = ymd_hms(DATETIME)) %>% 
    group_by(Core) %>% 
    dplyr::mutate(elapsed_days = as.double(difftime(DATETIME2, min(DATETIME2), units = "days")),
                  Treatment = factor(Treatment, levels = c("drydown", "drought", "sat", "sat_incubation")) 
)

picarro_sr = read.csv("data/processed/picarro_processed_sr.csv.gz")

picarro_sr2 = 
    picarro_sr %>% 
    dplyr::mutate(DATETIME2 = ymd_hms(DATETIME)) %>% 
    group_by(Core) %>% 
    dplyr::mutate(elapsed_days = as.double(difftime(DATETIME2, min(DATETIME2), units = "days")))


```


# 1. PICARRO DATA -- CPCRW

### individual cores  
```{r cpcrw_co2_flux_cores}
ggplot(picarro2, aes(elapsed_days, flux_co2_umol_g_s*1000, color = Core_assignment)) + 
    geom_point() + geom_line() +
    ylab("flux_co2_nmol_g_s")+
    facet_wrap(~Core_assignment)+
    #facet_grid(drying~length, scale = "free_x")+
    geom_hline(yintercept = 0)+
    theme(legend.position="none")
```

```{r cpcrw_co2_flux_cores2}
ggplot(picarro2, aes(elapsed_days, flux_co2_umol_g_s*1000, color = Treatment)) + 
    geom_point() + geom_line() +
    ylab("flux_co2_nmol_g_s")+
    facet_wrap(~Core_assignment)+
    #facet_grid(drying~length, scale = "free_x")+
    geom_hline(yintercept = 0)+
    theme(legend.position="top")
```

```{r}
ggplot(picarro2, aes(Treatment, flux_co2_umol_g_s*1000, color = Core_assignment)) + 
    geom_jitter() + geom_line() +
    ylab("flux_co2_nmol_g_s")+
    facet_grid(drying~length, scale = "free_x")+
    geom_hline(yintercept = 0)+
    theme(legend.position="none")
```

### tables -- by core
CO2: nmol_g_s
```{r}
picarro2 %>% 
    group_by(Core, Core_assignment, drying, length, Treatment) %>%
    dplyr::summarise(CO2_nmol_g_s = mean(flux_co2_umol_g_s)*1000) %>% 
    ungroup() %>% 
    dplyr::mutate(Treatment = factor(Treatment, levels = c("drydown", "drought", "sat", "sat_incubation"))) %>% 
    spread(Treatment, CO2_nmol_g_s) %>% 
    arrange(length, drying, Core) %>% 
    knitr::kable()
```

### tables -- by treatment
CO2: nmol_g_s
```{r}
picarro2 %>% 
    group_by(Core, Core_assignment, drying, length, Treatment) %>%
    dplyr::summarise(CO2_nmol_g_s = mean(flux_co2_umol_g_s)*1000) %>% 
    ungroup() %>% 
    group_by(drying, length, Treatment) %>%
    dplyr::summarise(CO2_nmol_g_s = mean(CO2_nmol_g_s)) %>% 
    dplyr::mutate(Treatment = factor(Treatment, levels = c("drydown", "drought", "sat", "sat_incubation"))) %>% 
    spread(Treatment, CO2_nmol_g_s) %>% 
    arrange(length, drying) %>% 
    knitr::kable()
```


### by treatment  
```{r cpcrw_co2_flux_trt}
ggplot(picarro2, aes(elapsed_days, flux_co2_umol_g_s*1000, color = Core_assignment)) + 
    geom_point() + geom_line() +
    ylab("flux_co2_nmol_g_s")+
    facet_grid(drying~length, scale = "free_x")+
    geom_hline(yintercept = 0)+
    theme(legend.position="none")
```

```{r cpcrw__co2_flux_trt2}
ggplot(picarro2, aes(DATETIME2, flux_co2_umol_g_s*1000, color = Core_assignment)) + 
    geom_point() + geom_line() +
    ylab("flux_co2_nmol_g_s")+
    facet_grid(drying~length)+
    geom_hline(yintercept = 0)+
    theme(legend.position="none")+
    theme(axis.text.x = element_text(angle = 90))

```

# 1. PICARRO DATA -- SR

### individual cores  
```{r sr_co2_flux_cores}
ggplot(picarro_sr2, aes(elapsed_days, flux_co2_umol_g_s*1000, color = Core_assignment)) + 
    geom_point() + geom_line() +
    ylab("flux_co2_nmol_g_s")+
    facet_wrap(~Core_assignment)+
    #facet_grid(drying~length, scale = "free_x")+
    geom_hline(yintercept = 0)+
    theme(legend.position="none")
```

### by treatment  
```{r sr_co2_flux_trt}
ggplot(picarro_sr2, aes(elapsed_days, flux_co2_umol_g_s*1000, color = Core_assignment)) + 
    geom_point() + geom_line() +
    ylab("flux_co2_nmol_g_s")+
    facet_grid(drying~length, scale = "free_x")+
    geom_hline(yintercept = 0)+
    theme(legend.position="none")
```

```{r sr_co2_flux_trt2}
ggplot(picarro_sr2, aes(DATETIME2, flux_co2_umol_g_s*1000, color = Core_assignment)) + 
    geom_point() + geom_line() +
    ylab("flux_co2_nmol_g_s")+
    facet_grid(drying~length)+
    geom_hline(yintercept = 0)+
    theme(legend.position="none")+
    theme(axis.text.x = element_text(angle = 90))
```
